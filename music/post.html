<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags and title -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Viewer</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <!-- CSS Stylesheet -->
    <link rel="stylesheet" href="post.css">
    <link rel="stylesheet" href="header.css">

    <!-- Include Showdown.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>

<body>

    <!-- Minimized Header with Equalizer on the Left -->
    <header class="minimized-header">
        <div class="equalizer" id="equalizer"></div>
        <h1><a href="index.html">Music Reviews</a></h1>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Decorative Background -->
        <div class="post-background"></div>

        <!-- Post Content Box -->
        <div class="post-box">
            <div id="post-content" class="markdown-body"></div>
        </div>
    </main>

    <!-- JavaScript code for Markdown conversion -->
    <script>
        // Get the Markdown file from the URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const file = urlParams.get("file");

        if (file) {
            fetch(file)
                .then((response) => {
                    if (!response.ok) throw new Error("Failed to load file");
                    return response.text();
                })
                .then((markdownContent) => {
                    // Convert Markdown to HTML using Showdown
                    const converter = new showdown.Converter();
                    document.getElementById("post-content").innerHTML = converter.makeHtml(markdownContent);

                    // Set the page title from the first heading in the Markdown
                    const firstHeading = document.querySelector(".markdown-body h1");
                    if (firstHeading) {
                        document.title = firstHeading.textContent;
                    }
                })
                .catch((error) => {
                    document.getElementById("post-content").innerHTML = `<p>Error: ${error.message}</p>`;
                });
        } else {
            document.getElementById("post-content").innerHTML = "<p>No post specified.</p>";
        }
    </script>

    <!-- JavaScript code for the equalizer animation -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const equalizer = document.getElementById('equalizer');
            const numberOfBars = 20; // Adjust the number of bars as needed

            for (let i = 0; i < numberOfBars; i++) {
                const bar = document.createElement('div');
                bar.classList.add('bar');

                // Assign a random animation duration between 0.8s and 1.5s
                const randomDuration = (Math.random() * 0.7 + 0.8).toFixed(2);
                bar.style.animationDuration = `${randomDuration}s`;

                // Assign a random animation delay between 0s and 0.5s
                const randomDelay = (Math.random() * 0.5).toFixed(2);
                bar.style.animationDelay = `${randomDelay}s`;

                equalizer.appendChild(bar);
            }
        });
    </script>

</body>
</html>
